<button
  #headerButton
  type="button"
  class="accordion-panel-header"
  role="button"
  [attr.id]="headerId()"
  [attr.aria-expanded]="isExpanded()"
  [attr.aria-controls]="panelId()"
  [attr.aria-disabled]="disabled() ? true : null"
  [attr.tabindex]="disabled() ? -1 : 0"
  (click)="toggle()"
  (keydown)="onKeydown($event)"
>
  @if (showIcon() && iconPosition() === 'start') {
    <span
      class="accordion-panel-icon icon-start"
      [class.expanded]="isExpanded()"
      aria-hidden="true"
    >
      @if (toggleIconTemplate(); as iconTpl) {
        <span class="icon-collapsed">
          <ng-container
            [ngTemplateOutlet]="iconTpl.template"
            [ngTemplateOutletContext]="{ $implicit: false, expanded: false }"
          />
        </span>
        <span class="icon-expanded">
          <ng-container
            [ngTemplateOutlet]="iconTpl.template"
            [ngTemplateOutletContext]="{ $implicit: true, expanded: true }"
          />
        </span>
      } @else {
        <ui-lib-icon class="icon-collapsed" [name]="collapseIcon()" />
        <ui-lib-icon class="icon-expanded" [name]="expandIcon()" />
      }
    </span>
  }
  <ng-content select="[accordionHeader]" />
  @if (!hasCustomHeader()) {
    <span class="accordion-panel-title">{{ header() }}</span>
  }
  @if (showIcon() && iconPosition() === 'end') {
    <span class="accordion-panel-icon icon-end" [class.expanded]="isExpanded()" aria-hidden="true">
      @if (toggleIconTemplate(); as iconTpl) {
        <span class="icon-collapsed">
          <ng-container
            [ngTemplateOutlet]="iconTpl.template"
            [ngTemplateOutletContext]="{ $implicit: false, expanded: false }"
          />
        </span>
        <span class="icon-expanded">
          <ng-container
            [ngTemplateOutlet]="iconTpl.template"
            [ngTemplateOutletContext]="{ $implicit: true, expanded: true }"
          />
        </span>
      } @else {
        <ui-lib-icon class="icon-collapsed" [name]="collapseIcon()" />
        <ui-lib-icon class="icon-expanded" [name]="expandIcon()" />
      }
    </span>
  }
</button>
<div
  class="accordion-panel-content"
  [class.expanded]="isExpanded()"
  [attr.id]="panelId()"
  role="region"
  [attr.aria-labelledby]="headerId()"
  [attr.hidden]="isExpanded() ? null : ''"
  [attr.data-state]="isExpanded() ? 'expanded' : 'collapsed'"
>
  <div class="accordion-panel-body">
    <ng-content />
  </div>
</div>
