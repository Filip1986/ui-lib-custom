<ui-lib-container size="lg" inset="lg" class="login-3-shell">
  <ui-lib-grid [columns]="12" [spacing]="6" class="login-3-grid" minColumnWidth="280px">
    <div class="brand" data-testid="login-3-left-panel">
      <ui-lib-stack [spacing]="3">
        <h1 data-testid="login-3-title">Welcome Back</h1>
        <p data-testid="login-3-subtitle">Sign in to continue your journey with us.</p>
      </ui-lib-stack>
    </div>

    <ui-lib-card
      variant="material"
      elevation="medium"
      class="login-3-card"
      data-testid="login-3-right-panel"
    >
      <ui-lib-stack [spacing]="4">
        <div class="header" data-testid="login-3-header">
          <h2 data-testid="login-3-form-title">{{ title() }}</h2>
          <p>Access your account</p>
        </div>

        <form
          [formGroup]="loginForm"
          (ngSubmit)="onSubmit()"
          class="form"
          data-testid="login-3-form"
        >
          <ui-lib-stack [spacing]="4">
            <div>
              <ui-lib-input
                id="username"
                label="Username or Email"
                placeholder="Username or Email"
                formControlName="username"
                variant="material"
                type="text"
                data-testid="login-3-username-input"
              ></ui-lib-input>
              @if (
                loginForm.controls['username'].invalid &&
                (loginForm.controls['username'].dirty ||
                  loginForm.controls['username'].touched ||
                  submitted())
              ) {
                <small class="error" data-testid="login-3-username-error"
                  >Please enter a valid username or email address</small
                >
              }
            </div>

            <div>
              <ui-lib-input
                id="password"
                label="Password"
                placeholder="Password"
                formControlName="password"
                variant="material"
                type="password"
                [showTogglePassword]="true"
                data-testid="login-3-password-input"
              ></ui-lib-input>
              @if (
                loginForm.controls['password'].invalid &&
                (loginForm.controls['password'].dirty ||
                  loginForm.controls['password'].touched ||
                  submitted())
              ) {
                <small class="error" data-testid="login-3-password-error"
                  >Password is required</small
                >
              }
              @if (features().showForgotPassword) {
                <button
                  type="button"
                  class="link align-end"
                  (click)="onForgotPassword()"
                  data-testid="login-3-forgot-password-link"
                >
                  Forgot password?
                </button>
              }
            </div>

            @if (features().showRememberMe) {
              <label class="remember" data-testid="login-3-remember-me-section">
                <input
                  type="checkbox"
                  formControlName="rememberMe"
                  (change)="onRememberMeChange($event)"
                  data-testid="login-3-remember-me-checkbox"
                />
                <span>Remember me</span>
              </label>
            }

            <ui-lib-button
              type="submit"
              color="primary"
              variant="material"
              [fullWidth]="true"
              [loading]="loading()"
              data-testid="login-3-submit-button"
            >
              Sign In
            </ui-lib-button>

            @if (features().showRegisterLink) {
              <div class="register" data-testid="login-3-register-section">
                <span>Don't have an account?</span>
                <button
                  type="button"
                  class="link"
                  (click)="onRegister()"
                  data-testid="login-3-register-link"
                >
                  Sign up now
                </button>
              </div>
            }

            @if (features().showSocialLogin) {
              <div class="social" data-testid="login-3-social-login-section">
                <div class="divider">OR CONTINUE WITH</div>
                <ui-lib-inline [spacing]="3" align="center" justify="start">
                  @for (provider of socialProviders(); track provider.id) {
                    <ui-lib-button
                      type="button"
                      variant="material"
                      appearance="outline"
                      color="secondary"
                      [fullWidth]="true"
                      [icon]="provider.icon ?? null"
                      (click)="onSocialLogin(provider.id)"
                      [attr.data-testid]="'login-3-' + provider.id + '-login-button'"
                    >
                      {{ provider.label }}
                    </ui-lib-button>
                  }
                </ui-lib-inline>
              </div>
            }
          </ui-lib-stack>
        </form>
      </ui-lib-stack>
    </ui-lib-card>
  </ui-lib-grid>
</ui-lib-container>
