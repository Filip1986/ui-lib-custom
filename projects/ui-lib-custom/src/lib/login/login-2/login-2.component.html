<ui-lib-container size="sm" inset="lg" class="login-2-shell">
  <ui-lib-stack [spacing]="6" align="stretch" justify="center" class="login-2-stack">
    <ui-lib-card variant="material" elevation="medium" [bordered]="true" class="login-2-card">
      <ui-lib-stack [spacing]="4">
        <div class="header" data-testid="login-2-header">
          <h1 data-testid="login-2-title">{{ title() }}</h1>
          <p data-testid="login-2-subtitle">Enter your credentials to continue</p>
        </div>

        <form
          [formGroup]="loginForm"
          (ngSubmit)="onSubmit()"
          class="form"
          data-testid="login-2-form"
        >
          <ui-lib-stack [spacing]="4">
            <div>
              <ui-lib-input
                id="username"
                label="Username or Email"
                placeholder="Enter your username or email"
                formControlName="username"
                variant="material"
                type="text"
                data-testid="login-2-username-input"
              ></ui-lib-input>
              @if (
                loginForm.controls['username'].invalid &&
                (loginForm.controls['username'].dirty ||
                  loginForm.controls['username'].touched ||
                  submitted())
              ) {
                <small class="error" data-testid="login-2-username-error"
                  >Username is required</small
                >
              }
            </div>

            <div>
              <ui-lib-input
                id="password"
                label="Password"
                placeholder="Enter your password"
                formControlName="password"
                variant="material"
                type="password"
                [showTogglePassword]="true"
                data-testid="login-2-password-input"
              ></ui-lib-input>
              @if (
                loginForm.controls['password'].invalid &&
                (loginForm.controls['password'].dirty ||
                  loginForm.controls['password'].touched ||
                  submitted())
              ) {
                <small class="error" data-testid="login-2-password-error"
                  >Password is required</small
                >
              }
            </div>

            <ui-lib-inline justify="space-between" align="center">
              @if (features().showRememberMe) {
                <label class="remember" data-testid="login-2-remember-me-section">
                  <input
                    type="checkbox"
                    formControlName="rememberMe"
                    (change)="onRememberMeChange($event)"
                    data-testid="login-2-remember-me-checkbox"
                  />
                  <span>Remember me</span>
                </label>
              }

              @if (features().showForgotPassword) {
                <button
                  type="button"
                  class="link"
                  (click)="onForgotPassword()"
                  data-testid="login-2-forgot-password-link"
                >
                  Forgot password?
                </button>
              }
            </ui-lib-inline>

            <ui-lib-button
              type="submit"
              color="primary"
              variant="material"
              [fullWidth]="true"
              [loading]="loading()"
              data-testid="login-2-submit-button"
            >
              Sign In
            </ui-lib-button>

            @if (features().showRegisterLink) {
              <div class="register" data-testid="login-2-register-section">
                <span>Don't have an account?</span>
                <button
                  type="button"
                  class="link"
                  (click)="onRegister()"
                  data-testid="login-2-register-link"
                >
                  Create account
                </button>
              </div>
            }

            @if (features().showSocialLogin) {
              <div class="social" data-testid="login-2-social-login-section">
                <div class="divider">Or continue with</div>
                <ui-lib-inline [spacing]="3" align="center" justify="start">
                  @for (provider of socialProviders(); track provider.id) {
                    <ui-lib-button
                      type="button"
                      variant="material"
                      appearance="outline"
                      color="secondary"
                      [fullWidth]="true"
                      [icon]="provider.icon ?? null"
                      (click)="onSocialLogin(provider.id)"
                      [attr.data-testid]="'login-2-' + provider.id + '-login-button'"
                    >
                      {{ provider.label }}
                    </ui-lib-button>
                  }
                </ui-lib-inline>
              </div>
            }
          </ui-lib-stack>
        </form>
      </ui-lib-stack>
    </ui-lib-card>
  </ui-lib-stack>
</ui-lib-container>
