<ui-lib-container size="sm" inset="lg" class="login-1-shell">
  <ui-lib-stack [spacing]="6" align="stretch" justify="center" class="login-1-stack">
    <ui-lib-card variant="material" elevation="medium" class="login-1-card">
      <div class="card-header">
        <h2 class="title" data-testid="login-1-login-title">{{ title() }}</h2>
        <p class="subtitle">Sign in to access your account</p>
      </div>

      <form
        class="form"
        [formGroup]="loginForm"
        (ngSubmit)="onSubmit()"
        data-testid="login-1-login-form"
      >
        <ui-lib-stack [spacing]="4">
          <div>
            <ui-lib-input
              id="username"
              label="Username or Email"
              placeholder="Enter your username or email"
              formControlName="username"
              variant="material"
              type="text"
              data-testid="login-1-username-input"
            ></ui-lib-input>
            @if (
              loginForm.controls['username'].invalid &&
              (loginForm.controls['username'].dirty ||
                loginForm.controls['username'].touched ||
                submitted())
            ) {
              <small class="error" data-testid="login-1-username-error"
                >Please enter a valid username or email</small
              >
            }
          </div>

          <div>
            <ui-lib-input
              id="password"
              label="Password"
              placeholder="Enter your password"
              formControlName="password"
              variant="material"
              type="password"
              data-testid="login-1-password-input"
              [showTogglePassword]="true"
            ></ui-lib-input>
            @if (
              loginForm.controls['password'].invalid &&
              (loginForm.controls['password'].dirty ||
                loginForm.controls['password'].touched ||
                submitted())
            ) {
              <small class="error" data-testid="login-1-password-error">Password is required</small>
            }
          </div>

          @if (features().showRememberMe || features().showForgotPassword) {
            <ui-lib-inline justify="space-between" align="center">
              @if (features().showRememberMe) {
                <label class="remember">
                  <input
                    type="checkbox"
                    formControlName="rememberMe"
                    (change)="onRememberMeChange($event)"
                    data-testid="login-1-remember-me-checkbox"
                  />
                  <span>Remember me</span>
                </label>
              }
              @if (features().showForgotPassword) {
                <button
                  type="button"
                  class="link"
                  (click)="onForgotPassword()"
                  data-testid="login-1-forgot-password-link"
                >
                  Forgot password?
                </button>
              }
            </ui-lib-inline>
          }

          <ui-lib-button
            type="submit"
            color="primary"
            variant="material"
            [fullWidth]="true"
            [loading]="loading()"
            data-testid="login-1-sign-in-button"
          >
            Sign In
          </ui-lib-button>

          @if (features().showRegisterLink) {
            <div class="register" data-testid="login-1-register-link-section">
              <span>Don't have an account?</span>
              <button
                type="button"
                class="link"
                (click)="onRegister()"
                data-testid="login-1-register-link"
              >
                Sign up now
              </button>
            </div>
          }

          @if (features().showSocialLogin) {
            <div class="social" data-testid="login-1-social-login-section">
              <div class="divider">OR</div>
              <ui-lib-inline [spacing]="3" align="center" justify="start">
                @for (provider of socialProviders(); track provider.id) {
                  <ui-lib-button
                    type="button"
                    variant="material"
                    appearance="outline"
                    color="secondary"
                    [fullWidth]="true"
                    [icon]="provider.icon ?? null"
                    (click)="onSocialLogin(provider.id)"
                    [attr.data-testid]="'login-1-' + provider.id + '-login-button'"
                  >
                    {{ provider.label }}
                  </ui-lib-button>
                }
              </ui-lib-inline>
            </div>
          }
        </ui-lib-stack>
      </form>
    </ui-lib-card>
  </ui-lib-stack>
</ui-lib-container>
